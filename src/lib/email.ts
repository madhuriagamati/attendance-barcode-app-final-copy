import nodemailer from 'nodemailer';
export function getTransport(){const host=process.env.SMTP_HOST;const port=process.env.SMTP_PORT?parseInt(process.env.SMTP_PORT):undefined;const secure=(process.env.SMTP_SECURE??'true')==='true';const user=process.env.SMTP_USER;const pass=process.env.SMTP_PASS;if(!host||!port||!user||!pass){const stubTransport=nodemailer.createTransport({streamTransport:true,newline:'unix',buffer:true} as any);return stubTransport;}return nodemailer.createTransport({host,port,secure,auth:{user,pass}});} 
export async function sendAttendanceEmail(to:string[],subject:string,html:string){const from=process.env.EMAIL_FROM||'Attendance Bot <no-reply@example.com>';const transport=getTransport();const info=await transport.sendMail({from,to:to.join(','),subject,html});if('message'in info&&typeof info.message==='string'){const fs=await import('fs/promises');const path=`/tmp/email-${Date.now()}.eml`;await fs.writeFile(path,info.message);console.log('Wrote test EML:',path);}else{console.log('Sent email:',(info as any).messageId);}}
