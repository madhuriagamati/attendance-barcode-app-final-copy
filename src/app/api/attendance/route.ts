import { prisma } from '@/lib/db';
export async function GET(req:Request){const{searchParams}=new URL(req.url);const from=searchParams.get('from');const to=searchParams.get('to');const studentId=searchParams.get('studentId');const limit=Math.min(parseInt(searchParams.get('limit')||'0')||0,200);const where:any={};if(from||to){where.timestamp={};if(from)where.timestamp.gte=new Date(from+'T00:00:00');if(to)where.timestamp.lte=new Date(to+'T23:59:59');}if(studentId)where.studentId=studentId;const items=await prisma.attendance.findMany({where,orderBy:{timestamp:'desc'},take:limit||undefined,include:{student:true}});const rows=items.map(i=>({id:i.id,timestamp:i.timestamp.toISOString(),student:i.student?.name||'',barcode:i.student?.barcode||'',type:i.type,note:i.notes||''}));return Response.json(rows);} 
